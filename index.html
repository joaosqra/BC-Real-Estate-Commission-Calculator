<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <!-- SEO & METADATA -->
  <title>BC Real Estate Commission Calculator | Realtor Split Tool</title>
  <meta name="description" content="Free BC real estate commission calculator. Instantly calculate listing and buyer agent splits, gross commission, and GST. Customizable rates for British Columbia realtors." />
  <meta name="keywords" content="BC real estate calculator, realtor commission calculator, real estate commission splits BC, British Columbia realtor tools, commission GST calculator, agent fees" />
  <meta name="author" content="joaosqra" />
  
  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://joaosqra.github.io/BC-Real-Estate-Commission-Calculator/" />
  <meta property="og:title" content="BC Real Estate Commission Calculator" />
  <meta property="og:description" content="A professional-grade calculator for BC realtors. Calculate splits, GST, and net commissions instantly." />
  <meta property="og:image" content="https://i.postimg.cc/X7pdtJyJ/SCR-20250616-nnqs.png" />

  <!-- Twitter -->
  <meta property="twitter:card" content="summary_large_image" />
  <meta property="twitter:url" content="https://joaosqra.github.io/BC-Real-Estate-Commission-Calculator/" />
  <meta property="twitter:title" content="BC Real Estate Commission Calculator" />
  <meta property="twitter:description" content="Professional tool for calculating real estate commissions and splits in British Columbia." />
  <meta property="twitter:image" content="https://i.postimg.cc/X7pdtJyJ/SCR-20250616-nnqs.png" />

  <!-- Structured Data (JSON-LD) for Google Rich Results -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "SoftwareApplication",
    "name": "BC Real Estate Commission Calculator",
    "applicationCategory": "FinanceApplication",
    "operatingSystem": "Web",
    "offers": {
      "@type": "Offer",
      "price": "0",
      "priceCurrency": "CAD"
    },
    "description": "A calculator tool specifically designed for British Columbia real estate agents to calculate commission splits and GST.",
    "author": {
      "@type": "Person",
      "name": "joaosqra",
      "url": "https://www.linkedin.com/in/joaosqra/"
    }
  }
  </script>
  
  <!-- Fonts: Inter (UI) and 'Digital' font for screen -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Share+Tech+Mono&display=swap" rel="stylesheet">

  <style>
    :root {
      /* Braun Palette */
      --braun-body: #191919;
      --braun-button-dark: #282828;
      --braun-button-brown: #3e3836;
      --braun-orange: #d94e18;
      --braun-green: #4a7a52;
      --braun-yellow: #d4b145;
      --braun-text: #ffffff;
      --screen-bg: #2b302b;
      --screen-text: #86c996; /* LCD Green */
      --error-red: #ff3b30;
      
      /* Dimensions */
      --btn-size: 48px;
      --spacing: 16px;
    }

    * { box-sizing: border-box; }

    body {
      font-family: 'Inter', sans-serif;
      /* Skeumorphic Desk Background */
      background-color: #dcdcd9;
      background-image: 
        radial-gradient(circle at 50% 50%, rgba(255,255,255,0.8) 0%, transparent 60%),
        url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.05'/%3E%3C/svg%3E"),
        linear-gradient(#dcdcd9, #b0b0ad);
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      padding: 20px;
    }

    /* The Main Device Body */
    .calculator-body {
      background-color: var(--braun-body);
      /* Subtle noise texture for plastic feel */
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='1.5' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.07'/%3E%3C/svg%3E");
      width: 100%;
      max-width: 420px;
      border-radius: 28px;
      padding: 36px 28px 44px;
      /* Deep shadow for floating effect */
      box-shadow: 
        0 50px 80px -20px rgba(0,0,0,0.6),
        0 10px 20px -5px rgba(0,0,0,0.4),
        inset 0 1px 0 rgba(255,255,255,0.15),
        inset 0 0 20px rgba(0,0,0,0.5); /* Inner darkening */
      position: relative;
    }
    
    /* Side reflection for 3D realism */
    .calculator-body::before {
      content: '';
      position: absolute;
      top: 30px; bottom: 30px; left: 12px; width: 2px;
      background: linear-gradient(to bottom, transparent, rgba(255,255,255,0.08), transparent);
      filter: blur(2px);
    }

    /* Branding */
    .brand {
      color: #fff;
      font-weight: 700;
      font-size: 14px;
      letter-spacing: 0.5px;
      margin-bottom: 24px;
      opacity: 0.9;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 4px;
    }
    
    .brand span { font-weight: 400; opacity: 0.6; font-size: 11px; margin-left: 6px; }

    /* The Main Screen (Price Input) */
    .lcd-screen-container {
      background: #0a0a0a;
      padding: 8px;
      border-radius: 10px;
      margin-bottom: 24px;
      box-shadow: 
        inset 0 2px 4px rgba(0,0,0,0.8),
        0 1px 0 rgba(255,255,255,0.1),
        0 -1px 0 rgba(0,0,0,0.5);
    }

    .lcd-screen {
      background-color: var(--screen-bg);
      border-radius: 4px;
      padding: 16px 20px;
      position: relative;
      overflow: hidden;
      min-height: 96px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      /* Inner shadow for depth */
      box-shadow: inset 0 0 20px rgba(0,0,0,0.6);
    }

    /* Scanlines effect */
    .lcd-screen::after {
      content: '';
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      background: repeating-linear-gradient(
        0deg,
        rgba(0,0,0,0.05),
        rgba(0,0,0,0.05) 1px,
        transparent 1px,
        transparent 3px
      );
      pointer-events: none;
      z-index: 1;
    }
    
    /* Screen Glare */
    .lcd-screen::before {
      content: '';
      position: absolute;
      top: -50%; left: -50%; width: 200%; height: 200%;
      background: radial-gradient(circle at 70% 30%, rgba(255,255,255,0.07), transparent 15%);
      pointer-events: none;
      z-index: 2;
    }

    .screen-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 3;
    }

    .screen-label {
      color: var(--screen-text);
      font-size: 10px;
      text-transform: uppercase;
      opacity: 0.7;
      font-family: 'Share Tech Mono', monospace;
    }

    /* Error Indicator on Screen */
    .error-indicator {
      font-family: 'Share Tech Mono', monospace;
      color: var(--error-red); /* Red LED style */
      font-size: 10px;
      text-transform: uppercase;
      opacity: 0; /* Hidden by default */
      text-shadow: 0 0 5px rgba(255, 59, 48, 0.5);
      transition: opacity 0.2s;
      background: rgba(50, 0, 0, 0.5);
      padding: 2px 4px;
      border-radius: 2px;
    }
    
    .error-indicator.visible { opacity: 1; }

    input#price {
      width: 100%;
      background: transparent;
      border: none;
      color: var(--screen-text);
      font-family: 'Share Tech Mono', monospace;
      font-size: 38px;
      text-align: right;
      outline: none;
      text-shadow: 0 0 5px rgba(134, 201, 150, 0.5);
      padding: 0;
      margin-top: 4px;
      z-index: 3;
      caret-color: var(--screen-text);
    }
    
    input#price::placeholder {
      color: var(--screen-text);
      opacity: 0.3;
    }

    /* --- Memory Bank Controls --- */
    .memory-bank {
      display: flex;
      justify-content: space-between;
      margin-bottom: 20px;
      padding: 0 4px;
    }

    .mem-btn {
      width: 42px;
      height: 28px;
      border-radius: 4px;
      border: none;
      background: #2a2a2a;
      color: #888;
      font-size: 10px;
      font-weight: 700;
      cursor: pointer;
      box-shadow: 
        0 2px 4px rgba(0,0,0,0.4),
        inset 0 1px 0 rgba(255,255,255,0.08);
      transition: all 0.1s;
      position: relative;
      overflow: hidden;
    }

    .mem-btn::before {
      content: '';
      position: absolute;
      top: 0; left: 0; right: 0; height: 50%;
      background: linear-gradient(rgba(255,255,255,0.05), transparent);
    }

    .mem-btn:active {
      transform: translateY(1px);
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.5);
      background: #222;
    }

    .mem-btn.saved-flash {
      animation: flashGreen 0.4s ease-out;
    }

    @keyframes flashGreen {
      0% { background-color: var(--braun-green); color: white; }
      100% { background-color: #2a2a2a; color: #888; }
    }

    .mem-btn.reset {
      background: var(--braun-yellow);
      color: #222;
      box-shadow: 
        0 2px 4px rgba(0,0,0,0.3),
        inset 0 1px 0 rgba(255,255,255,0.2);
    }
    
    .mem-btn.reset:active {
      background: #bfa03e;
      color: #111;
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.2);
    }

    .mem-label {
      font-size: 9px;
      color: #555;
      text-align: center;
      margin-top: 4px;
      text-transform: uppercase;
    }


    /* The Configuration Grid (Commission Splits) */
    .controls-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
      margin-bottom: 32px;
    }

    .input-group {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .input-group label {
      color: #888;
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-left: 2px;
      font-weight: 600;
    }

    .analog-input {
      width: 100%;
      background-color: var(--braun-button-dark);
      border: none;
      border-radius: 6px; 
      color: white;
      padding: 14px 16px;
      font-size: 16px;
      font-family: 'Inter', sans-serif;
      text-align: center;
      transition: all 0.15s ease-out;
      
      /* Physical key look */
      box-shadow: 
        0 4px 0 #151515,
        0 6px 6px rgba(0,0,0,0.3),
        inset 0 1px 0 rgba(255,255,255,0.08);
      transform: translateY(0);
      
      /* Subtle noise on keys too */
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='1.5' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.05'/%3E%3C/svg%3E");
    }

    .analog-input:focus {
      outline: none;
      background-color: #333;
      transform: translateY(2px);
      box-shadow: 
        0 2px 0 #151515,
        inset 0 0 0 1px var(--braun-orange);
    }

    /* Divider Line */
    .divider {
      height: 2px;
      background: #111;
      margin: 0 -28px 24px;
      border-bottom: 1px solid rgba(255,255,255,0.06);
    }

    /* Results Section */
    .results-section {
      display: grid;
      gap: 20px;
    }

    .result-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .result-info {
      display: flex;
      flex-direction: column;
    }

    .result-label {
      color: #777;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 4px;
      font-weight: 600;
    }

    .result-value {
      color: #fff;
      font-size: 20px;
      font-family: 'Inter', sans-serif;
      font-weight: 500;
      letter-spacing: -0.5px;
    }

    .result-value.negative {
      color: var(--braun-orange); 
    }

    /* The Tactile Buttons */
    .btn-round {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      border: none;
      color: white;
      font-size: 10px;
      font-weight: 700;
      text-transform: uppercase;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      
      /* Convex Button Shape */
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.1), transparent), var(--braun-button-brown);
      box-shadow: 
        0 4px 6px rgba(0,0,0,0.4),
        inset 0 1px 0 rgba(255,255,255,0.12);
      transition: transform 0.1s, box-shadow 0.1s;
    }

    .btn-round:active {
      transform: translateY(2px);
      box-shadow: 
        0 1px 2px rgba(0,0,0,0.4),
        inset 0 2px 4px rgba(0,0,0,0.2);
    }

    .btn-orange {
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.25), transparent), var(--braun-orange);
      box-shadow: 
        0 4px 8px rgba(217, 78, 24, 0.3),
        inset 0 1px 0 rgba(255,255,255,0.2);
    }
    
    .btn-dark {
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.1), transparent), #222;
    }

    .footer {
      margin-top: 36px;
      text-align: center;
      color: #444;
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 1px;
      text-shadow: 0 1px 0 rgba(255,255,255,0.05);
    }
    
    .footer a { color: #555; text-decoration: none; }

    /* Tooltip for Copy */
    .copy-feedback {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: var(--braun-orange);
      color: white;
      padding: 12px 24px;
      border-radius: 4px; /* Squarer for industrial look */
      font-weight: 600;
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 1px;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s;
      z-index: 100;
      box-shadow: 0 10px 30px rgba(0,0,0,0.4);
    }
    
    .copy-feedback.visible { opacity: 1; }
    
    /* Error Banner */
    .error-banner {
      background: rgba(217, 78, 24, 0.1);
      border: 1px solid var(--braun-orange);
      color: var(--braun-orange);
      font-size: 11px;
      padding: 8px 12px;
      border-radius: 4px;
      margin-top: 16px;
      display: none;
      text-align: center;
    }
    .error-banner.visible { display: block; }
    
    /* Memory Feedback Toast */
    .memory-toast {
      position: absolute;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.8);
      color: var(--braun-green);
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 10px;
      font-family: 'Share Tech Mono', monospace;
      opacity: 0;
      transition: opacity 0.3s;
      pointer-events: none;
    }
    .memory-toast.visible { opacity: 1; }

  </style>
</head>
<body>

  <div class="calculator-body">
    
    <div class="brand">
      <div>BRAUN <span>ET66</span></div>
      <div style="width: 40px; height: 12px; background: #222; border-radius: 2px; box-shadow: inset 0 1px 3px rgba(0,0,0,0.5);"></div> <!-- Solar Sensor -->
    </div>

    <!-- MAIN DISPLAY -->
    <div class="lcd-screen-container">
      <div class="lcd-screen">
        <div class="screen-header">
            <div class="screen-label">Offer Price</div>
            <div class="error-indicator" id="screen-error">ERROR</div>
        </div>
        <input type="text" id="price" placeholder="0" inputmode="numeric" />
        <div id="mem-feedback" class="memory-toast">SAVED TO M1</div>
      </div>
    </div>

    <!-- MEMORY CONTROLS -->
    <div class="memory-bank">
        <div>
            <button class="mem-btn reset" onclick="resetDefaults()" title="Reset to BC Default">C</button>
            <div class="mem-label">Reset</div>
        </div>
        <div>
            <button class="mem-btn" id="m1-btn">M1</button>
            <div class="mem-label">Hold Save</div>
        </div>
        <div>
            <button class="mem-btn" id="m2-btn">M2</button>
            <div class="mem-label">Hold Save</div>
        </div>
        <div>
            <button class="mem-btn" id="m3-btn">M3</button>
            <div class="mem-label">Hold Save</div>
        </div>
    </div>

    <!-- CONFIGURATION INPUTS -->
    <div class="controls-grid">
      <div class="input-group">
        <label>Gross (1st 100k)</label>
        <input class="analog-input" type="text" id="total_first" value="7%" />
      </div>
      <div class="input-group">
        <label>Gross (Bal)</label>
        <input class="analog-input" type="text" id="total_rest" value="3%" />
      </div>
      <div class="input-group">
        <label>Co-op (1st 100k)</label>
        <input class="analog-input" type="text" id="coop_first" value="3.255%" />
      </div>
      <div class="input-group">
        <label>Co-op (Bal)</label>
        <input class="analog-input" type="text" id="coop_rest" value="1.1625%" />
      </div>
    </div>

    <div class="divider"></div>

    <!-- RESULTS (Readouts) -->
    <div class="results-section">
      
      <!-- Row 1: Gross -->
      <div class="result-row">
        <div class="result-info">
          <span class="result-label">Total Commission</span>
          <span class="result-value" id="gross">$0.00</span>
        </div>
        <button class="btn-round" onclick="copySingle('gross')">Copy</button>
      </div>

      <!-- Row 2: Listing Agent (Swapped Up) -->
      <div class="result-row">
        <div class="result-info">
          <span class="result-label" style="color: #fff; font-weight: 600;">Listing Agent</span>
          <span class="result-value" id="listing">$0.00</span>
        </div>
        <!-- Orange Button for Primary Action -->
        <button class="btn-round btn-orange" onclick="copySingle('listing')">Copy</button>
      </div>

      <!-- Row 3: Buyer's Agent (Swapped Down) -->
      <div class="result-row">
        <div class="result-info">
          <span class="result-label">Buyer's Agent</span>
          <span class="result-value" id="coop">$0.00</span>
        </div>
        <button class="btn-round btn-dark" onclick="copySingle('coop')">Copy</button>
      </div>

       <!-- Row 4: GST -->
       <div class="result-row">
        <div class="result-info">
          <span class="result-label">GST (5%)</span>
          <span class="result-value" id="gst" style="opacity: 0.6; font-size: 16px;">$0.00</span>
        </div>
      </div>

      <!-- Error Message Area -->
      <div id="error-msg" class="error-banner">
        ‚ö†Ô∏è Listing commission is negative. Check splits.
      </div>

    </div>

    <div class="footer">
      Designed in BC üá®üá¶ by <a href="https://www.linkedin.com/in/joaosqra/" target="_blank">@joaosqra</a>
    </div>

  </div>

  <!-- Feedback Toast -->
  <div id="toast" class="copy-feedback">Copied</div>

  <script>
    // --- Configuration ---
    const DEFAULTS = {
        totalFirst: "7%",
        totalRest: "3%",
        coopFirst: "3.255%",
        coopRest: "1.1625%"
    };

    // --- Logic ---
    const formatCurrency = (val) => 
      new Intl.NumberFormat('en-CA', { style: 'currency', currency: 'CAD' }).format(val);

    const parsePercent = (val) => {
      if (!val) return 0;
      return parseFloat(val.replace(/[^0-9.]/g, '')) / 100 || 0;
    };

    const parseNumber = (val) => {
      if (!val) return 0;
      return parseFloat(String(val).replace(/,/g, '')) || 0;
    };

    const formatNumberWithCommas = (val) => {
      if (!val) return '';
      return val.toLocaleString('en-CA');
    };

    function calculate() {
      const priceVal = document.getElementById('price').value;
      const price = parseNumber(priceVal);

      // Get Split Configs
      const totalFirst = parsePercent(document.getElementById('total_first').value);
      const totalRest = parsePercent(document.getElementById('total_rest').value);
      const coopFirst = parsePercent(document.getElementById('coop_first').value);
      const coopRest = parsePercent(document.getElementById('coop_rest').value);

      // Logic
      const first100k = Math.min(100000, price);
      const remaining = Math.max(0, price - 100000);

      const gross = (first100k * totalFirst) + (remaining * totalRest);
      const coop = (first100k * coopFirst) + (remaining * coopRest);
      const listing = gross - coop;
      const gst = gross * 0.05;

      // Render
      document.getElementById('gross').innerText = formatCurrency(gross);
      document.getElementById('coop').innerText = formatCurrency(coop);
      document.getElementById('listing').innerText = formatCurrency(listing);
      document.getElementById('gst').innerText = formatCurrency(gst);

      // Error indication
      const listingEl = document.getElementById('listing');
      const errorMsg = document.getElementById('error-msg');
      const screenError = document.getElementById('screen-error');
      
      if (listing < 0) {
        listingEl.classList.add('negative');
        errorMsg.classList.add('visible');
        screenError.classList.add('visible');
      } else {
        listingEl.classList.remove('negative');
        errorMsg.classList.remove('visible');
        screenError.classList.remove('visible');
      }
    }

    // --- Memory Functions ---
    function setupMemoryButtons() {
        ['m1', 'm2', 'm3'].forEach(id => {
            const btn = document.getElementById(id + '-btn');
            let pressTimer;

            // Mouse events
            btn.addEventListener('mousedown', () => {
                pressTimer = window.setTimeout(() => saveToMemory(id), 600);
            });
            btn.addEventListener('mouseup', () => {
                clearTimeout(pressTimer);
            });
            btn.addEventListener('click', (e) => {
                // If it was a short click (timer didn't fire)
                if (e.detail === 1) loadFromMemory(id);
            });

            // Touch events for mobile
            btn.addEventListener('touchstart', (e) => {
                e.preventDefault(); // prevent mouse emulation
                pressTimer = window.setTimeout(() => saveToMemory(id), 600);
            });
            btn.addEventListener('touchend', () => {
                clearTimeout(pressTimer);
                // Simple touch load logic (if not saved)
                // This is simplified; ideally we check duration
            });
        });
    }

    function saveToMemory(slot) {
        const config = {
            totalFirst: document.getElementById('total_first').value,
            totalRest: document.getElementById('total_rest').value,
            coopFirst: document.getElementById('coop_first').value,
            coopRest: document.getElementById('coop_rest').value
        };
        localStorage.setItem('calc_mem_' + slot, JSON.stringify(config));
        
        // Feedback
        const btn = document.getElementById(slot + '-btn');
        btn.classList.add('saved-flash');
        setTimeout(() => btn.classList.remove('saved-flash'), 400);
        
        showMemoryFeedback(`SAVED TO ${slot.toUpperCase()}`);
    }

    function loadFromMemory(slot) {
        const saved = localStorage.getItem('calc_mem_' + slot);
        if (saved) {
            const config = JSON.parse(saved);
            document.getElementById('total_first').value = config.totalFirst;
            document.getElementById('total_rest').value = config.totalRest;
            document.getElementById('coop_first').value = config.coopFirst;
            document.getElementById('coop_rest').value = config.coopRest;
            calculate();
            showMemoryFeedback(`LOADED ${slot.toUpperCase()}`);
        } else {
            showMemoryFeedback(`${slot.toUpperCase()} EMPTY`);
        }
    }

    function resetDefaults() {
        document.getElementById('total_first').value = DEFAULTS.totalFirst;
        document.getElementById('total_rest').value = DEFAULTS.totalRest;
        document.getElementById('coop_first').value = DEFAULTS.coopFirst;
        document.getElementById('coop_rest').value = DEFAULTS.coopRest;
        calculate();
        showMemoryFeedback("RESET DEFAULTS");
    }

    function showMemoryFeedback(text) {
        const el = document.getElementById('mem-feedback');
        el.innerText = text;
        el.classList.add('visible');
        setTimeout(() => el.classList.remove('visible'), 1500);
    }


    // --- Input Formatting ---
    function handleFocus(e) {
      let val = e.target.value;
      if (e.target.id === 'price') {
        val = val.replace(/,/g, '');
      } else {
        val = val.replace('%', '');
      }
      e.target.value = val;
      e.target.select();
    }

    function handleBlur(e) {
      if (e.target.id === 'price') {
        const num = parseNumber(e.target.value);
        if (num > 0) e.target.value = formatNumberWithCommas(num);
      } else {
        let raw = parseFloat(e.target.value);
        if (!isNaN(raw)) {
           e.target.value = raw + '%';
        }
      }
      calculate();
    }
    
    // Strict input filter for Price
    function restrictInput(e) {
        if (e.target.id === 'price') {
            const clean = e.target.value.replace(/[^0-9]/g, '');
            if (clean !== e.target.value) {
                e.target.value = clean;
            }
            calculate();
        }
    }

    // --- Clipboard ---
    function copySingle(id) {
      const rawText = document.getElementById(id).innerText;
      const val = rawText.replace(/[^\d.]/g, '');
      
      navigator.clipboard.writeText(val).then(() => {
        showToast();
      });
    }

    function showToast() {
        const toast = document.getElementById('toast');
        toast.classList.add('visible');
        setTimeout(() => toast.classList.remove('visible'), 1500);
    }

    // --- Init ---
    document.addEventListener('DOMContentLoaded', () => {
      const inputs = document.querySelectorAll('input');
      inputs.forEach(i => {
        if(i.id === 'price') {
             i.addEventListener('input', restrictInput);
        } else {
             i.addEventListener('input', calculate);
        }
        i.addEventListener('focus', handleFocus);
        i.addEventListener('blur', handleBlur);
      });
      
      setupMemoryButtons();
      calculate();
    });
  </script>
</body>
</html>
